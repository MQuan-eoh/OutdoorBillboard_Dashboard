# ğŸ¨ OTA Workflow - SÆ¡ Äá»“ Visual

## 1ï¸âƒ£ ARCHITECTURE DIAGRAM

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 GITHUB                                       â”‚
â”‚  https://github.com/MinhQuan7/ITS_OurdoorBillboard-/releases               â”‚
â”‚                                                                              â”‚
â”‚  Release v1.0.2                                                             â”‚
â”‚  â”œâ”€ Asset: ITS-Billboard.exe (163 MB)                                      â”‚
â”‚  â””â”€ Asset: latest.yml (metadata)                                           â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ â¬‡ï¸ Electron-Updater gá»i GitHub API
     â”‚ â¬‡ï¸ Download .exe tá»«:
     â”‚ â¬‡ï¸ https://github.com/.../releases/download/v1.0.2/ITS-Billboard.exe
     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DESKTOP APP (Electron)                              â”‚
â”‚                     ITS Outdoor Billboard v1.0.2                           â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Main Process (Node.js Backend)                                     â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  â€¢ main.js - Xá»­ lÃ½ OTA logic                                       â”‚   â”‚
â”‚  â”‚  â€¢ MQTT Service - Giao tiáº¿p qua MQTT                              â”‚   â”‚
â”‚  â”‚  â€¢ Electron-Updater - Download update                             â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  Files quan trá»ng:                                                 â”‚   â”‚
â”‚  â”‚  â”œâ”€ resources/app-update.yml                                       â”‚   â”‚
â”‚  â”‚  â”‚  version: 1.0.2                                                 â”‚   â”‚
â”‚  â”‚  â”‚  url: .../v1.0.2/ITS-Billboard.exe                             â”‚   â”‚
â”‚  â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â”œâ”€ package.json                                                   â”‚   â”‚
â”‚  â”‚  â”‚  "version": "1.0.2",                                            â”‚   â”‚
â”‚  â”‚  â”‚  "nsis": { "artifactName": "ITS-Billboard.exe" }              â”‚   â”‚
â”‚  â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â””â”€ %AppData%/ITS-Outdoor-Billboard/ (Runtime)                    â”‚   â”‚
â”‚  â”‚     â””â”€ app-update.yml (Generated by ensureAppUpdateFile)         â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Renderer Process (React UI)                                        â”‚   â”‚
â”‚  â”‚  â€¢ Weather panel, Banner display, etc                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  MQTT Topics:                                                               â”‚
â”‚  â”œâ”€ LISTEN: its/billboard/update/check (tá»« web-admin)               â”‚   â”‚
â”‚  â”œâ”€ LISTEN: its/billboard/update/force (tá»« web-admin)               â”‚   â”‚
â”‚  â””â”€ PUBLISH: its/billboard/update/status (gá»­i vá» web-admin)         â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â¬†ï¸ MQTT Topic: its/billboard/update/status
     â”‚ Data: {status: "update_available", version: "1.0.2"}
     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            WEB ADMIN                                        â”‚
â”‚                    (admin-web/index.html)                                   â”‚
â”‚                                                                              â”‚
â”‚  â€¢ Hiá»ƒn thá»‹: "CÃ³ phiÃªn báº£n má»›i v1.0.2"                                    â”‚
â”‚  â€¢ NÃºt: "Cáº­p nháº­t ngay" â†’ Gá»­i force_update command                        â”‚
â”‚  â€¢ Nháº­n status: "Downloading 50%", "Done", etc                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2ï¸âƒ£ SEQUENCE DIAGRAM - CHI TIáº¾T Tá»ªNG BÆ¯á»šC

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WEB ADMIN   â”‚              â”‚ DESKTOP APP  â”‚          â”‚   GITHUB     â”‚
â”‚              â”‚              â”‚              â”‚          â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                             â”‚                        â”‚
       â”‚  1. Báº¥m "Kiá»ƒm tra          â”‚                        â”‚
       â”‚     cáº­p nháº­t"              â”‚                        â”‚
       â”‚                             â”‚                        â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚                        â”‚
       â”‚  MQTT: check_update        â”‚                        â”‚
       â”‚                             â”‚                        â”‚
       â”‚                             â”‚  2. Gá»i API            â”‚
       â”‚                             â”‚     GitHub             â”‚
       â”‚                             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                             â”‚                        â”‚
       â”‚                             â”‚  3. So sÃ¡nh version    â”‚
       â”‚                             â”‚     1.0.2 (current)    â”‚
       â”‚                             â”‚     vs 1.0.3 (latest)  â”‚
       â”‚                             â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                             â”‚  GitHub Response:      â”‚
       â”‚                             â”‚  "1.0.3 available"     â”‚
       â”‚                             â”‚                        â”‚
       â”‚  4. Pháº£n há»“i MQTT           â”‚                        â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
       â”‚  update_available: v1.0.3   â”‚                        â”‚
       â”‚                             â”‚                        â”‚
       â”‚                             â”‚                        â”‚
       â”‚  5. Báº¥y "Cáº­p nháº­t ngay"    â”‚                        â”‚
       â”‚                             â”‚                        â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚                        â”‚
       â”‚  MQTT: force_update        â”‚                        â”‚
       â”‚                             â”‚                        â”‚
       â”‚                             â”‚  6. Download .exe      â”‚
       â”‚                             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                             â”‚ (from:                 â”‚
       â”‚                             â”‚ .../v1.0.3/            â”‚
       â”‚                             â”‚ ITS-Billboard.exe)     â”‚
       â”‚                             â”‚                        â”‚
       â”‚                             â”‚     â³ Downloading     â”‚
       â”‚                             â”‚     â³ 50%...         â”‚
       â”‚  7. Status: downloading     â”‚                        â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
       â”‚  50%, 75%, 100%             â”‚                        â”‚
       â”‚                             â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                             â”‚  (File transfer)       â”‚
       â”‚                             â”‚                        â”‚
       â”‚  8. Status: downloaded      â”‚                        â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
       â”‚                             â”‚                        â”‚
       â”‚  9. Status: installing      â”‚  10. Install & Restart â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€â”€â–º (App restarts)     â”‚
       â”‚                             â”‚                        â”‚
       â”‚                             â”‚                        â”‚
       â”‚                    [5 giÃ¢y sau]                      â”‚
       â”‚                             â”‚                        â”‚
       â”‚                             â”‚ âœ… App v1.0.3 cháº¡y    â”‚
       â”‚                             â”‚                        â”‚
       â”‚  11. Status: success        â”‚                        â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
       â”‚  "Cáº­p nháº­t thÃ nh cÃ´ng"      â”‚                        â”‚
       â”‚                             â”‚                        â”‚

[Timeline: ~3-5 phÃºt tá»« bÆ°á»›c 5 Ä‘áº¿n bÆ°á»›c 11]
```

---

## 3ï¸âƒ£ FILE DEPENDENCY DIAGRAM

```
ğŸ“¦ package.json
â”‚  version: "1.0.2"
â”‚  build.nsis.artifactName: "ITS-Billboard.exe"
â”‚
â”œâ”€â”€â–º ğŸ“„ resources/app-update.yml (packaged)
â”‚    â”‚  version: 1.0.2
â”‚    â”‚  path: ITS-Billboard.exe
â”‚    â”‚  url: .../v1.0.2/ITS-Billboard.exe
â”‚    â”‚
â”‚    â””â”€â”€â–º ğŸ”§ Electron App Runtime
â”‚         â””â”€â”€â–º ensureAppUpdateFile()
â”‚              â”œâ”€â–º Äá»c phiÃªn báº£n tá»« app.getVersion()
â”‚              â”œâ”€â–º Táº¡o manifest náº¿u chÆ°a cÃ³
â”‚              â””â”€â–º app-update.yml (runtime) âœ…
â”‚
â”œâ”€â”€â–º ğŸ—ï¸ npm run build:nsis (Electron-Builder)
â”‚    â”‚  â”œâ”€â–º Äá»c package.json version
â”‚    â”‚  â”œâ”€â–º Táº¡o installer vá»›i tÃªn: ITS-Billboard.exe
â”‚    â”‚  â”‚   (VÃ¬ artifactName = "ITS-Billboard.exe")
â”‚    â”‚  â”‚
â”‚    â”‚  â””â”€â–º ğŸ“‚ dist/
â”‚    â”‚      â”œâ”€ ITS-Billboard.exe (163 MB)
â”‚    â”‚      â””â”€ latest.yml (manifest template)
â”‚    â”‚
â”‚    â””â”€â”€â–º ğŸš€ Upload lÃªn GitHub Release
â”‚         â”‚  Tag: v1.0.2
â”‚         â”‚  Assets:
â”‚         â”‚  â”œâ”€ ITS-Billboard.exe
â”‚         â”‚  â””â”€ latest.yml
â”‚         â”‚
â”‚         â””â”€â”€â–º ğŸŒ https://github.com/MinhQuan7/ITS_OurdoorBillboard-/releases/tag/v1.0.2
â”‚              âœ… NgÆ°á»i dÃ¹ng download tá»« Ä‘Ã¢y
â”‚
â””â”€â”€â–º ğŸ“„ latest.yml (template)
     â”‚  version: 1.0.2
     â”‚  url: ITS-Billboard.exe (relative)
     â”‚
     â””â”€â”€â–º ğŸ”„ CI/CD Pipeline (GitHub Actions)
          â””â”€â–º Auto-update latest.yml tá»« dist/latest.yml
              khi build
```

---

## 4ï¸âƒ£ STATE MACHINE - TRáº NG THÃI Cá»¦A APP

```
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚   APP RUNNING   â”‚
               â”‚   v1.0.2        â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ MQTT: check_update
                        â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚   CHECKING      â”‚ â—„â”€â”€ API GitHub
               â”‚   FOR UPDATES   â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                       â”‚
         No Update           Update Available
            â”‚                       â”‚
            â–¼                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    IDLE      â”‚        â”‚  AVAILABLE   â”‚
    â”‚              â”‚        â”‚  (SEND MSG)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ MQTT: force_update
                                   â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚  DOWNLOADING â”‚ â—„â”€â”€ GitHub Release
                            â”‚              â”‚     .../ITS-Billboard.exe
                            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ âœ… Download Success
                                   â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚  INSTALLING  â”‚
                            â”‚              â”‚
                            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ Wait 5 sec
                                   â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚  RESTARTING  â”‚ â—„â”€â”€ quitAndInstall()
                            â”‚              â”‚
                            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ App exits & restarts
                                   â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚  APP RUNNING â”‚
                            â”‚   v1.0.3     â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Exception Paths]
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚   ERROR      â”‚â—„â”€â”€ Network fail
                           â”‚              â”‚   GitHub down
                           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   Invalid URL
                                  â”‚
                                  â”‚ MQTT: error status
                                  â–¼
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚  IDLE        â”‚
                           â”‚  (Retry?)    â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5ï¸âƒ£ MQTT MESSAGE FORMAT

### ğŸ“¤ WEB ADMIN â†’ DESKTOP APP

**Topic:** `its/billboard/update/check`

```json
{
  "action": "check_update",
  "timestamp": 1730000000000
}
```

**Topic:** `its/billboard/update/force`

```json
{
  "action": "force_update",
  "timestamp": 1730000000000
}
```

---

### ğŸ“¥ DESKTOP APP â†’ WEB ADMIN

**Topic:** `its/billboard/update/status`

**Khi cÃ³ update má»›i:**

```json
{
  "status": "update_available",
  "version": "1.0.3",
  "timestamp": 1730000000000
}
```

**Khi Ä‘ang download:**

```json
{
  "status": "downloading",
  "version": "1.0.3",
  "percent": 50,
  "bytesPerSecond": 5242880,
  "timestamp": 1730000000000
}
```

**Khi thÃ nh cÃ´ng:**

```json
{
  "status": "success",
  "version": "1.0.3",
  "timestamp": 1730000000000
}
```

**Khi lá»—i:**

```json
{
  "status": "error",
  "error": "Cannot download ..., status 404",
  "timestamp": 1730000000000
}
```

---

## 6ï¸âƒ£ VERSION SYNC TABLE

### âœ… CORRECT (Hiá»‡n Táº¡i ÄÃ£ Fix)

| Component                  | Version                      |
| -------------------------- | ---------------------------- |
| `package.json`             | 1.0.2                        |
| `resources/app-update.yml` | 1.0.2                        |
| `latest.yml`               | 1.0.2                        |
| GitHub Release Tag         | v1.0.2                       |
| GitHub Asset               | ITS-Billboard.exe            |
| URL in manifest            | .../v1.0.2/ITS-Billboard.exe |

**âœ… Táº¥t cáº£ match â†’ OTA hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng**

---

### âŒ INCORRECT (TrÆ°á»›c Khi Fix)

| Component                  | Version                                   | Issue         |
| -------------------------- | ----------------------------------------- | ------------- |
| `package.json`             | 1.0.1                                     | âš ï¸            |
| `resources/app-update.yml` | 1.0.1                                     | âš ï¸            |
| `latest.yml`               | 1.0.2                                     | ğŸ”´ MISMATCH   |
| GitHub Release Tag         | v1.0.2                                    | ğŸ”´ MISMATCH   |
| GitHub Asset               | ITS-Billboard.exe                         | âœ…            |
| URL in manifest            | .../ITS-Outdoor-Billboard-Setup-1.0.2.exe | ğŸ”´ WRONG NAME |

**âŒ KhÃ´ng sync â†’ 404 Error**

---

## 7ï¸âƒ£ MANIFEST FILE COMPARISON

### ğŸ“„ resources/app-update.yml (Packaged)

```yaml
# ÄÆ°á»£c packaged cÃ¹ng app
# Load láº§n Ä‘áº§u khi app cháº¡y
# Náº¿u runtime file khÃ´ng tá»“n táº¡i, dÃ¹ng cÃ¡i nÃ y

version: 1.0.2
files:
  - url: https://github.com/MinhQuan7/ITS_OurdoorBillboard-/releases/download/v1.0.2/ITS-Billboard.exe
    sha512: ""
    size: 163333376
path: ITS-Billboard.exe
sha512: ""
releaseDate: 2025-10-31T04:39:21.706Z
```

### ğŸ“„ latest.yml (Template/Distribution)

```yaml
# ÄÆ°á»£c generate tá»« npm run build:nsis
# LÃ  template cho build process
# Upload lÃªn GitHub release

version: 1.0.2
files:
  - url: https://github.com/MinhQuan7/ITS_OurdoorBillboard-/releases/download/v1.0.2/ITS-Billboard.exe
    sha512: PLACEHOLDER_SHA512_HASH_WILL_BE_UPDATED_AFTER_BUILD
    size: 163333376
path: ITS-Billboard.exe
sha512: PLACEHOLDER_SHA512_HASH_WILL_BE_UPDATED_AFTER_BUILD
releaseDate: "2025-10-31T00:00:00.000Z"
```

### ğŸ“„ Runtime app-update.yml (Generated)

```yaml
# Generated by ensureAppUpdateFile() á»Ÿ:
# C:\Users\[User]\AppData\Roaming\ITS-Outdoor-Billboard\app-update.yml

# Táº¡o ngoÃ i láº§n Ä‘áº§u náº¿u chÆ°a cÃ³
# DÃ¹ng template tá»« resources/app-update.yml

version: 1.0.2
files:
  - url: https://github.com/MinhQuan7/ITS_OurdoorBillboard-/releases/download/v1.0.2/ITS-Billboard.exe
    sha512: ""
    size: 0
path: ITS-Billboard.exe
sha512: ""
releaseDate: 2025-10-31T05:00:00.000Z
```

---

## 8ï¸âƒ£ CONFIG vs RUNTIME

```
ğŸ”§ CONFIG TIME (Build/Package)
â”œâ”€â–º npm run build:nsis
â”‚   â””â”€â–º Äá»c package.json
â”‚       â”œâ”€ version: 1.0.2
â”‚       â”œâ”€ artifactName: ITS-Billboard.exe
â”‚       â””â”€â–º Sinh installer: dist/ITS-Billboard.exe
â”‚
â””â”€â–º Trong installer package:
    â””â”€â–º resources/app-update.yml Ä‘Æ°á»£c embed
        (Khi cÃ i app, file nÃ y Ä‘Æ°á»£c copy vÃ o AppData)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸš€ RUNTIME (App cháº¡y)
â”œâ”€â–º App khá»Ÿi Ä‘á»™ng
â”‚
â”œâ”€â–º ensureAppUpdateFile() cháº¡y
â”‚   â”œâ”€ Kiá»ƒm tra: AppData/app-update.yml tá»“n táº¡i?
â”‚   â”‚  âœ… CÃ³ â†’ DÃ¹ng cÃ¡i Ä‘Ã³
â”‚   â”‚  âŒ KhÃ´ng â†’ Copy tá»« resources/app-update.yml
â”‚   â”‚
â”‚   â””â”€ Äá»c app.getVersion() (tá»« package.json)
â”‚      â””â”€â–º Táº¡o URL: .../v{version}/ITS-Billboard.exe
â”‚
â”œâ”€â–º MQTT command tá»« web admin
â”‚   â”œâ”€ check_update â†’ autoUpdater.checkForUpdates()
â”‚   â””â”€ force_update â†’ autoUpdater.downloadUpdate()
â”‚
â””â”€â–º Update downloaded â†’ autoUpdater.quitAndInstall()
    â””â”€â–º Restart app
```

---

## 9ï¸âƒ£ GITHUB RELEASES STRUCTURE

```
https://github.com/MinhQuan7/ITS_OurdoorBillboard-/releases

Releases List:
â”œâ”€ v1.0.3 (latest)
â”‚  â”œâ”€ ITS-Billboard.exe (163 MB) â† Main installer
â”‚  â”œâ”€ ITS-Billboard.exe.blockmap (metadata for delta update)
â”‚  â””â”€ latest.yml â† Manifest with checksums
â”‚
â”œâ”€ v1.0.2 (current)
â”‚  â”œâ”€ ITS-Billboard.exe
â”‚  â”œâ”€ ITS-Billboard.exe.blockmap
â”‚  â””â”€ latest.yml
â”‚
â””â”€ v1.0.1 (old)
   â”œâ”€ ITS-Billboard.exe
   â”œâ”€ ITS-Billboard.exe.blockmap
   â””â”€ latest.yml

Electron-updater Algorithm:
1. Read current version: v1.0.2
2. Query GitHub API: List releases
3. Find latest version: v1.0.3
4. Compare: 1.0.3 > 1.0.2 âœ… â†’ "Update available"
5. Get URL: .../releases/download/v1.0.3/ITS-Billboard.exe
6. Download & Install
```

---

## ğŸ”Ÿ TROUBLESHOOTING DECISION TREE

```
                    âŒ OTA KHÃ”NG HOáº T Äá»˜NG
                           â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                     â”‚
        Error: 404             Status khÃ´ng
        File not found         sync
                â”‚                    â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚           â”‚           â”‚    â”‚             â”‚
Issue 1:   Issue 2:    Issue 3:  Version    Package
TÃªn file   URL sai     Asset     mismatch   version?
sai                    khÃ´ng
    â”‚           â”‚           â”‚    tá»“n táº¡i     â”‚
    â”‚           â”‚           â”‚       â”‚        â”‚
    â–¼           â–¼           â–¼       â–¼        â–¼

Check:      Check:      Check:   Check:   Update:
artifact    URL          GitHub   Sync    package.
Name in     in           release  all     json
package.    manifest     assets   files   version
json

âœ… ITS-     âœ… .../     âœ… Has   âœ… All   âœ… Same
Billboard    v1.0.2/     file    same    in all
.exe        ITS-                 version  files
            Billboard
            .exe
```

---

**SÆ¡ Ä‘á»“ nÃ y giÃºp báº¡n hiá»ƒu rÃµ: Tá»« Developer upload code â†’ NgÆ°á»i dÃ¹ng nháº­n update âœ…**

Báº¥t ká»³ bÆ°á»›c nÃ o khÃ´ng align sáº½ gÃ¢y lá»—i 404 hoáº·c version mismatch!
